
<!-- /Page Header -->

<!-- Search Filter -->
<div id="filter_inputs" class="card filter-card">
       <div class="card-body pb-0">
              <div class="row">
                     <div class="col-sm-6 col-md-3">
                            <div class="form-group">
                                   <label>Name</label>
                                   <input type="text" class="form-control" />
                            </div>
                     </div>
                     <div class="col-sm-6 col-md-3">
                            <div class="form-group">
                                   <label>Email</label>
                                   <input type="text" class="form-control" />
                            </div>
                     </div>
                     <div class="col-sm-6 col-md-3">
                            <div class="form-group">
                                   <label>Phone</label>
                                   <input type="text" class="form-control" />
                            </div>
                     </div>
              </div>
       </div>
</div>

<!-- Bloc de chargement -->
<div *ngIf="dataIsloading" class="row">
       <div *ngFor="let plh of [1,1,1,1,1,1,1,1,1,1,1,1]; let i = index"
              class="col-12 col-md-2 col-lg-4 col-xl-3">
              <app-oncomming-list-placeholder></app-oncomming-list-placeholder>
       </div>
</div>

<!-- <p>
     <button (click)="backClicked()" class="btn btn-primary me-2"
                        style="color: #035858 !important; background-color: #ffff !important;">
                        <i class="fas fa-arrow-left"></i> {{ 'back' | translate }}
     </button>
  </p> -->

<div class="row" *ngIf="!dataIsloading">
       <div class="card-table card-list-user">
              <div class="card-body" style="position: relative;">
                     <div class="backdrop" (click)="onMouseLeave('user')"
                            [ngStyle]="{ 
                                                                      'backdrop-filter': showBackdrop ? 'blur(4px)' :'blur(0px)',
                                                                      'background': showBackdrop ? 'hsl(0deg 0% 0% / 3%)' :'hsl(0deg 0% 0% / 0%)',
                                                                      'z-index': showBackdrop  ? '10' :'0'
                                                                      
                                                                      }"
                            style="
                                                               
                                                               position: absolute;
                                                               top: 0;
                                                               left: 0;
                                                               height: 100%;
                                                               width: 100%;
                                                               background: hsl(0deg 0% 0% / 3%);
                                                               transition-duration: 150ms;
                                                                /* z-index: 5; */
                                                               "></div>
                     <div class="table-responsive">
                            <div class="table-scroll" style="border: none;">
                                   <table matSort
                                          (matSortChange)="sortData($event)"
                                          class="table table-stripped table-hover datatable"
                                          style="display: flex;
                                          flex-direction: column;
                                          background-color: rgba(255, 255, 255, 0);
                                          border: none;">
                                          <thead class="thead-light"
                                                 style="display: none;">
                                                 <tr>
                                                        <th
                                                               mat-sort-header="user">{{'user.user'
                                                               | translate
                                                               }}</th>

                                                        <th
                                                               mat-sort-header="role">
                                                               Role </th>
                                                        <th
                                                               mat-sort-header="actions">Actions</th>
                                                 </tr>
                                          </thead>
                                          <tbody
                                                 style="display: flex;flex-wrap: wrap;justify-content: space-between;">

                                                 <tr
                                                        [ngStyle]="{ 
                                                               'padding': showElement && idxHover === indexUser && customer.roles.length >4 ? '10px 0px' :'10px 8px',
                                                              'z-index': showElement && idxHover === indexUser || idxHover === indexUser  ? '1000' : '1'
                                                               }"
                                                        class="tr"
                                                        style=" 
                                                        width: 24.5%;
                                                        border-radius: 20px;
                                                        height: 240px;
                                                        margin-bottom: 15px;
                                                        padding: 10px 25px ;
                                                        background-color: white;
                                                        transition-duration: 200ms;
                                                        border: 1px solid hsl(214deg 100% 61% / 20%) !important;
                                                 "
                                                        (click)="buildListRoleChooseUser(customer)"
                                                        *ngFor="let customer of dataSource.data; let indexUser = index;">
                                                        <!-- <td>
                                                               <h2
                                                                      class="table-avatar">
                                                                      <span
                                                                             class="avatar avatar-sm me-2"><img
                                                                                    class="avatar-img rounded-circle"
                                                                                    src="../../../../../assets/img/3dAvatar.png"
                                                                                    alt="User Image" /></span>
                                                                      <span>{{
                                                                             customer.firstName
                                                                             }}
                                                                             {{
                                                                             customer.lastName
                                                                             }}</span>
                                                               </h2>
                                                        </td> -->

                                                        <td
                                                               [ngStyle]="{ 'height': showElement  && idxHover === indexUser  && customer.roles.length >4? 'max-content' : '100%',
                                                                             'padding': showElement && idxHover === indexUser && customer.roles.length >4 ? '0px 8px 30px 8px' :'0',
                                                                             'border': showElement && idxHover === indexUser && customer.roles.length >4 ? '0px solid hsl(214deg 100% 61% / 20%) ' :'none',
                                                                             'border-radius': showElement && idxHover === indexUser && customer.roles.length >4 ? '20px ' :'0',
                                                                             'box-shadow': showElement && idxHover === indexUser && customer.roles.length >4 ? '0 0px 8px hsl(214deg 100% 61% / 20%) ' : 'none'
 
                                                                }"
                                                               style=" background-color: white ;display: flex;flex-direction: column; justify-content: space-between;padding: 0;">
                                                               <h2
                                                                      class="table-avatar">
                                                                      <a
                                                                             class="avatar avatar-sm me-2"><img
                                                                                    class="avatar-img rounded-circle"
                                                                                    src="../../../../../assets/img/3dAvatar.png"
                                                                                    alt="User Image" /></a>
                                                                      <a>
                                                                             {{
                                                                             customer.email
                                                                             }}</a>
                                                               </h2>

                                                               <div
                                                                      [ngStyle]="{ 'height': showElement  && idxHover === indexUser  && customer.roles.length >4 ? 'max-content' : '150px'  }"
                                                                      class="ctnRole"
                                                                      style="    height: 150px; overflow: hidden;"
                                                                      class="row row-role"
                                                                      *ngIf="customer.roles.length !== 0
                                                                       ">
                                                                      <div
                                                                             *ngFor="let id of customer.roles; let idxRole = index"
                                                                             class="col-xl-2 col-lg-4 col-sm-6 col-12"
                                                                             style="width: 50% !important ; margin-bottom: 7px; margin-top: 7px;">
                                                                             <div
                                                                                    class="card inovices-card"
                                                                                    style="margin: 0 !important; padding: 5px 2px;">
                                                                                    <div
                                                                                           class="card-body">
                                                                                           <div
                                                                                                  class="dash-widget-header mb-0">

                                                                                                  <div
                                                                                                         (mouseenter)="onMouseRoleEnter(indexUser,idxRole)"
                                                                                                         (mouseleave)="onMouseLeave('role')"
                                                                                                         class="dash-count">
                                                                                                         <div
                                                                                                                class="dash-title"
                                                                                                                style="font: 400 calc(14px * 0.83) / 20px Roboto, 'Helvetica Neue', sans-serif;
                                                                                                                color: hsl(214deg 100% 61% / 70%)  !important;
                                                                                                                display: flex;
                                                                                                                       align-items: center;
                                                                                                                ">
                                                                                                                <div
                                                                                                                       [ngStyle]="{ 'overflow': showElement  && idxHover === indexUser  && customer.roles.length >4 ? 'visible' : 'hidden',
                                                                                                                'white-space': showElement  && idxHover === indexUser  && customer.roles.length >4 ? 'break-spaces' : 'nowrap'  }"
                                                                                                                       style="overflow: hidden;width: 70px;">
                                                                                                                       {{
                                                                                                                       getRoleNameById(id,'description')
                                                                                                                       }}</div>

                                                                                                                <span
                                                                                                                       (click)="removeUserRole(customer._id,id)"
                                                                                                                       [ngStyle]="{ 'visibility': idxHover === indexUser  &&  idxRole == idxRoleHover ? 'visible' : 'hidden' }">

                                                                                                                       <button
                                                                                                                              style="    padding: 0px 5px;"
                                                                                                                              type="button"
                                                                                                                              class="btn btn-rounded btn-outline-danger me-1">
                                                                                                                              <i
                                                                                                                                     class="fa fa-trash"
                                                                                                                                     data-bs-toggle="tooltip"
                                                                                                                                     title="supprimer"></i>
                                                                                                                       </button>
                                                                                                                </span>
                                                                                                         </div>

                                                                                                         <div
                                                                                                                class="dash-counts">
                                                                                                                <p
                                                                                                                       style="font-size: 12px;"
                                                                                                                       class="mb-0">{{
                                                                                                                       getRoleNameById(id,'name')
                                                                                                                       }}</p>
                                                                                                         </div>
                                                                                                  </div>
                                                                                           </div>
                                                                                    </div>
                                                                             </div>
                                                                      </div>

                                                               </div>

                                                               <div
                                                                      [ngStyle]="{ 
                                                                             'margin-top': showElement && idxHover === indexUser && customer.roles.length >4 ? '25px' :'0'
                                                                             
                                                                }"
                                                                      class="row row-role">
                                                                      <div
                                                                             class="col-7 ">
                                                                             <div
                                                                                    class="btn-group">
                                                                                    <button
                                                                                           type="button"
                                                                                           class="btn btn-primary">Roles</button>
                                                                                    <button
                                                                                           (click)="onMouseRoleBtnEnter(indexUser); closeDropdown('true')"
                                                                                           type="button"
                                                                                           class="btn btn-primary dropdown-toggle dropdown-toggle-split me-1"
                                                                                           data-bs-toggle="dropdown"
                                                                                           aria-haspopup="true"
                                                                                           aria-expanded="false"
                                                                                           #roleDropdown>
                                                                                           <span
                                                                                                  class="visually-hidden">Toggle
                                                                                                  Dropdown</span>
                                                                                    </button>
                                                                                    <div
                                                                                           [ngStyle]="{'visibility' : showDropDown  ?  'visible' : 'hidden'}"
                                                                                           style="z-index: 20;  top: -13px;"
                                                                                           class="dropdown-menu ">
                                                                                           <a
                                                                                                  *ngFor="let roleGet of this.roleService.listRole"
                                                                                                  class="dropdown-item"
                                                                                                  (click)="stopPropagation($event)">
                                                                                                  <label
                                                                                                         class="custom_check">
                                                                                                         <input
                                                                                                                [(ngModel)]="roleGet.checked"
                                                                                                                type="checkbox"
                                                                                                                [checked]="roleGet.isEnable"
                                                                                                                value
                                                                                                                id="flexCheckDefault"
                                                                                                                (change)="updateCheckboxState(roleGet)"
                                                                                                                name="invoice">
                                                                                                         <span
                                                                                                                class="checkmark"></span>
                                                                                                         <span>{{roleGet.name}}</span>
                                                                                                  </label></a>

                                                                                           <div
                                                                                                  class="dropdown-divider"></div>
                                                                                           <button
                                                                                                  style="width: 100%;"
                                                                                                  (click)="addRoleOnUser(customer._id); showUserID(customer._id);stopPropagation($event)"
                                                                                                  type="button"
                                                                                                  class="btn btn-primary">
                                                                                                  <span
                                                                                                         [ngStyle]="{
                                                                                                                 'display': isAddingRole ?  'inline-block' : ' none '
                                                                                                         }"
                                                                                                         class="spinner-border spinner-border-sm"
                                                                                                         role="status"
                                                                                                         aria-hidden="true"></span>
                                                                                                  <span
                                                                                                         [ngStyle]="{'display': isAddingRole ?  'none' : 'inline-block'}">ajouter</span>
                                                                                           </button>
                                                                                    </div>
                                                                             </div>
                                                                      </div>
                                                                      <div
                                                                             style="display: flex
;
                                                                             align-items: center;
                                                                             align-items: end;
                                                                             padding-bottom: 2px;
                                                                             color: #0d6efd;
                                                                             font-size: 13px;
                                                                             line-height: 17px;"
                                                                             class="col-5 ">

                                                                             <a
                                                                                    (click)="onMouseEnter(0,indexUser,indexUser,customer.roles.length)">Voir
                                                                                    <br>
                                                                                    tous
                                                                                    les
                                                                                    roles</a>
                                                                      </div>
                                                               </div>
                                                        </td>

                                                        <!-- <td style="
    width: 129%;
">
                                                               <div
                                                                      class="row row-role"
                                                                      *ngIf="customer.roles.length !== 0">
                                                                      <div
                                                                             *ngFor="let id of customer.roles;"
                                                                             class="col-xl-2 col-lg-4 col-sm-6 col-12"
                                                                             style="width: 30.666667% !important ; margin-bottom: 17px; margin-top: 17px;">
                                                                             <div
                                                                                    class="card inovices-card"
                                                                                    style="margin: 0 !important; padding: 17px;">
                                                                                    <div
                                                                                           class="card-body">
                                                                                           <div
                                                                                                  class="dash-widget-header mb-0">
                                                                                                  <span
                                                                                                         class="inovices-widget-icon rounded-circle bg-info-light">
                                                                                                         <img
                                                                                                                src="../../../../../assets/img2/icons/receipt-item.svg"
                                                                                                                alt="image" />
                                                                                                  </span>
                                                                                                  <div
                                                                                                         class="dash-count">
                                                                                                         <div
                                                                                                                class="dash-title">{{
                                                                                                                getRoleNameById(id,'description')
                                                                                                                }}</div>
                                                                                                         <div
                                                                                                                class="dash-counts">
                                                                                                                <p
                                                                                                                       class="mb-0">{{
                                                                                                                       getRoleNameById(id,'name')
                                                                                                                       }}</p>
                                                                                                         </div>
                                                                                                  </div>
                                                                                           </div>
                                                                                    </div>
                                                                             </div>
                                                                      </div>

                                                               </div>
                                                        </td>

                                                        <td
                                                               class="d-flex align-items-center">

                                                               <div
                                                                      class="row row-role">
                                                                      <div
                                                                             class="col-xl-2 col-lg-4 col-sm-6 col-12">
                                                                             <div
                                                                                    class="btn-group">
                                                                                    <button
                                                                                           type="button"
                                                                                           class="btn btn-primary">Action</button>
                                                                                    <button
                                                                                           type="button"
                                                                                           class="btn btn-primary dropdown-toggle dropdown-toggle-split me-1"
                                                                                           data-bs-toggle="dropdown"
                                                                                           aria-haspopup="true"
                                                                                           aria-expanded="false">
                                                                                           <span
                                                                                                  class="visually-hidden">Toggle
                                                                                                  Dropdown</span>
                                                                                    </button>
                                                                                    <div
                                                                                           class="dropdown-menu">
                                                                                           <a
                                                                                                  *ngFor="let roleGet of this.roleService.listRole"
                                                                                                  class="dropdown-item"
                                                                                                  (click)="stopPropagation($event)">
                                                                                                  <label
                                                                                                         class="custom_check">
                                                                                                         <input
                                                                                                                [(ngModel)]="roleGet.checked"
                                                                                                                type="checkbox"
                                                                                                                [checked]="roleGet.isEnable"
                                                                                                                value
                                                                                                                id="flexCheckDefault"
                                                                                                                (change)="updateCheckboxState(roleGet)"
                                                                                                                name="invoice">
                                                                                                         <span
                                                                                                                class="checkmark"></span>
                                                                                                         <span>{{roleGet.name}}</span>
                                                                                                  </label></a>

                                                              
                                                                                           <div
                                                                                                  class="dropdown-divider"></div>
                                                                                           <button
                                                                                                  (click)="addRoleOnUser(customer._id); showUserID(customer._id);stopPropagation($event)"
                                                                                                  type="button"
                                                                                                  class="btn btn-primary">ajouter</button>
                                                                                    </div>
                                                                             </div>
                                                                      </div>
                                                               </div>
                                                        </td> -->
                                                 </tr>
                                          </tbody>
                                   </table>
                            </div>
                     </div>

                     <app-custom-pagination></app-custom-pagination>

              </div>
       </div>
</div>
